(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},i=[],s=0;s<e.length;s++){var l=e[s],c=a.base?l[0]+a.base:l[0],d=r[c]||0,p="".concat(c," ").concat(d);r[c]=d+1;var u=n(p),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(m);else{var g=o(m,a);a.byIndex=s,t.splice(s,0,{identifier:p,updater:g,references:1})}i.push(p)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=a(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var s=n(r[i]);t[s].references--}for(var l=a(e,o),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},159:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(601),o=n.n(a),r=n(314),i=n.n(r)()(o());i.push([e.id,'/* ===============================\n   Story SPA â€“ Clean Base Styles\n   =============================== */\n\n/* ---------- Theme & Tokens ---------- */\n:root{\n    --bg: #ffffff;\n    --fg: #0b1020;\n    --muted: #6b7280;\n    --primary: #2563eb;\n    --primary-ink: #ffffff;\n    --surface: #f8fafc;\n    --border: #e5e7eb;\n    --radius: 12px;\n    --shadow: 0 10px 20px rgba(2,6,23,.06), 0 2px 6px rgba(2,6,23,.06);\n    --maxw: 1100px;\n  }\n  \n  /* ---------- Reset ringan ---------- */\n  * { box-sizing: border-box; }\n  html, body { height: 100%; }\n  body{\n    margin: 0;\n    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;\n    color: var(--fg);\n    background: var(--bg);\n  }\n  \n  /* ---------- A11y: skip link & focus ---------- */\n  .skip-link{\n    position: absolute; left: -9999px; top: 0;\n    background: #111; color: #fff; padding: 8px 12px; border-radius: 8px;\n  }\n  .skip-link:focus{ left: 12px; top: 12px; z-index: 1000; }\n  :focus{ outline: none; }                /* hilangkan outline Safari */\n  :focus-visible{\n    outline: 3px solid var(--primary);\n    outline-offset: 2px;\n  }\n  \n  /* ---------- Layout helpers ---------- */\n  .container{\n    max-width: var(--maxw);\n    margin-inline: auto;\n    padding: clamp(16px, 1.5vw, 24px);\n  }\n  main{ min-height: 70vh; }\n  footer{\n    border-top: 1px solid var(--border);\n    padding: 16px; color: var(--muted);\n  }\n  \n  /* ---------- Typography ---------- */\n  h1{ font-size: clamp(28px, 3.6vw, 40px); margin: 24px 0 16px; }\n  h2{ font-size: clamp(18px, 2.2vw, 22px); margin: 12px 0 8px; }\n  \n  /* ===============================\n     Header & Navigation\n     =============================== */\n  @view-transition { navigation: auto; }\n  ::view-transition-old(root), ::view-transition-new(root){ animation-duration: .18s; }\n  \n  header{\n    position: sticky; top: 0; z-index: 100;\n    background: rgba(255,255,255,.9);\n    backdrop-filter: saturate(180%) blur(12px);\n    border-bottom: 1px solid var(--border);\n    box-shadow: 0 1px 4px rgba(0,0,0,.05);\n  }\n  header nav{\n    display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;\n    max-width: var(--maxw); margin: 0 auto; padding: 12px 20px;\n  }\n  .nav-left{ display: flex; align-items: center; gap: 8px; font-weight: 700; font-size: 18px; }\n  .nav-right{ display: flex; align-items: center; gap: 10px; }\n  \n  header a{\n    color: var(--fg); text-decoration: none; font-weight: 600;\n    padding: 6px 10px; border-radius: 8px; transition: background .2s, color .2s;\n  }\n  header a:hover{ background: var(--primary); color: var(--primary-ink); }\n  \n  header .btn-primary{\n    background: var(--primary); color: var(--primary-ink);\n    border: none; border-radius: 999px; padding: 8px 16px; font-weight: 700;\n    cursor: pointer; transition: background .2s, transform .1s;\n    box-shadow: 0 6px 14px rgba(37,99,235,.25);\n  }\n  header .btn-primary:hover{ background: #1d4ed8; transform: translateY(-1px); }\n  header .btn-primary:active{ transform: translateY(1px); }\n  \n  header .btn-secondary{\n    background: transparent; color: var(--primary);\n    border: 2px solid var(--primary); border-radius: 999px; padding: 6px 14px;\n    font-weight: 600; cursor: pointer; transition: background .2s, color .2s;\n  }\n  header .btn-secondary:hover{ background: var(--primary); color: var(--primary-ink); }\n  \n  @media (max-width: 640px){\n    header nav{ flex-direction: column; align-items: flex-start; gap: 8px; }\n    .nav-right{ flex-wrap: wrap; }\n  }\n  .success {\n    color: #059669;\n    font-weight: 600;\n    margin-top: 8px;\n    animation: fadeIn 0.4s ease;\n  }\n  .error {\n    color: #dc2626;\n    font-weight: 600;\n    margin-top: 8px;\n    animation: fadeIn 0.4s ease;\n  }\n  @keyframes fadeIn {\n    from { opacity: 0; transform: translateY(-3px); }\n    to { opacity: 1; transform: translateY(0); }\n  }\n  /* ===============================\n     Cards & Lists\n     =============================== */\n  .card{\n    background: var(--surface);\n    border: 1px solid var(--border);\n    border-radius: var(--radius);\n    padding: 14px;\n    box-shadow: var(--shadow);\n    display: flex; flex-direction: column; gap: 8px;\n  }\n  .list{\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n    gap: 16px; margin-top: 16px;\n  }\n  .card img{ width: 100%; height: auto; border-radius: 10px; object-fit: cover; }\n  \n  /* ===============================\n     Map (Leaflet)\n     =============================== */\n  #map, .map{\n    width: 100%;\n    height: 440px;                 /* pastikan cukup tinggi */\n    border-radius: var(--radius);\n    overflow: hidden;\n    background: #e5eef4;\n    box-shadow: var(--shadow);\n  }\n  .leaflet-control-layers{ border-radius: 10px !important; }\n  /* Map (Leaflet) */\n.map { width: 100%; border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); }\n.map-home { height: 420px; background:#e5eef4; }   /* untuk Home */\n.map-add  { height: 520px; background:#e5eef4; }   /* untuk Add Story */\n\n/* opsional: smoothing control layer */\n.leaflet-control-layers { border-radius: 10px !important; }\n  /* ===============================\n     Forms\n     =============================== */\n  form.form{\n    display: grid; gap: 10px;\n    background: var(--surface);\n    border: 1px solid var(--border);\n    border-radius: var(--radius);\n    padding: 16px;\n    box-shadow: var(--shadow);\n    margin-top: 16px;\n  }\n  label{ font-weight: 600; color: #111; }\n  input, textarea, select{\n    width: 100%; border: 1px solid var(--border); border-radius: 10px;\n    padding: 10px 12px; font: inherit; background: #fff;\n  }\n  textarea{ resize: vertical; min-height: 92px; }\n  input:focus-visible, textarea:focus-visible{ border-color: var(--primary); }\n  \n  .row-2{ display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }\n  @media (max-width: 540px){ .row-2{ grid-template-columns: 1fr; } }\n  \n  button, .btn{\n    appearance: none; border: 0; border-radius: 999px;\n    background: var(--primary); color: var(--primary-ink);\n    padding: 10px 16px; font-weight: 700; cursor: pointer;\n    box-shadow: 0 6px 14px rgba(37,99,235,.25);\n    transition: transform .06s ease, filter .06s ease;\n  }\n  button:hover{ filter: brightness(1.05); }\n  button:active{ transform: translateY(1px); }\n  button[disabled]{ opacity: .6; cursor: not-allowed; box-shadow: none; }\n  \n  .success{ color: #059669; margin: 0; }\n  .error{ color: #dc2626; margin: 0; }\n  .hint{ color: var(--muted); }\n  \n  /* ---------- Auth visibility helpers ---------- */\n  .guest-only, .auth-only{ display: none; }\n  body.guest .guest-only{ display: inline; }\n  body.auth  .auth-only { display: inline; }\n  \n  /* ---------- Reduced motion ---------- */\n  @media (prefers-reduced-motion: reduce){\n    *{ animation: none !important; transition: none !important; }\n\n    /* sembunyikan tombol berdasarkan status auth */\nbody.guest .auth-only { display: none !important; }\nbody.auth  .guest-only { display: none !important; }\n  }',""]);const s=i},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,a,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&i[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,o&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={id:a,exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var a=n(72),o=n.n(a),r=n(825),i=n.n(r),s=n(659),l=n.n(s),c=n(56),d=n.n(c),p=n(540),u=n.n(p),m=n(113),g=n.n(m),f=n(159),h={};h.styleTagTransform=g(),h.setAttributes=d(),h.insert=l().bind(null,"head"),h.domAPI=i(),h.insertStyleElement=u(),o()(f.A,h),f.A&&f.A.locals&&f.A.locals;const y="https://story-api.dicoding.dev/v1",b="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",v=y,w=()=>{const e=localStorage.getItem("token");return e?{Authorization:`Bearer ${e}`}:{}},x=async({name:e,email:t,password:n})=>(await fetch(`${v}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:n})})).json(),k=async({email:e,password:t})=>(await fetch(`${v}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})})).json(),S={async list({page:e=1,size:t=20,withLocation:n=!0}={}){const a=new URL(`${v}/stories`);return a.searchParams.set("page",e),a.searchParams.set("size",t),a.searchParams.set("location",n?1:0),(await fetch(a,{headers:{...w()}})).json()},async create({description:e,photoFile:t,lat:n,lon:a,guest:o=!1}){const r=new FormData;r.append("description",e),r.append("photo",t),null!=n&&r.append("lat",n),null!=a&&r.append("lon",a);const i=o?`${v}/stories/guest`:`${v}/stories`;return(await fetch(i,{method:"POST",headers:o?{}:{...w()},body:r})).json()}};let q;function E(){return new Promise((e,t)=>{if(q)return e(q);const n=indexedDB.open("story-spa",2);n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("stories")||t.createObjectStore("stories",{keyPath:"id"}),t.objectStoreNames.contains("outbox")||t.createObjectStore("outbox",{keyPath:"id",autoIncrement:!0})},n.onsuccess=()=>{q=n.result,e(q)},n.onerror=()=>t(n.error)})}async function C(){const e=await E();return new Promise((t,n)=>{const a=e.transaction("outbox","readonly").objectStore("outbox").getAll();a.onsuccess=()=>t(a.result||[]),a.onerror=()=>n(a.error)})}async function T(e){const t=(await E()).transaction("outbox","readwrite");return t.objectStore("outbox").delete(e),t.done?.catch?.(()=>{})}async function A(){const e=document.createElement("section");e.innerHTML='\n    <h1>Daftar Story</h1>\n\n    \x3c!-- Banner offline muncul jika data di-load dari IndexedDB --\x3e\n    <p id="offlineBanner" class="hint" style="display:none" aria-live="polite">\n      Mode offline: menampilkan data lokal yang tersimpan.\n    </p>\n\n    \x3c!-- Search/filter --\x3e\n    <form class="form" role="search" aria-label="Filter story" style="margin-top:12px">\n      <label for="q">Cari story (nama/teks)</label>\n      <input id="q" type="search" placeholder="Ketik untuk memfilter..." autocomplete="off" />\n    </form>\n\n    <div id="map-home" class="map map-home" aria-label="Peta story"></div>\n\n    <div class="list" id="list" aria-live="polite"></div>\n\n    <p class="guest-only">\n      Untuk melihat data dari API, silakan <a href="#/login">login</a>.\n    </p>\n  ';const t=localStorage.getItem("token"),n=e.querySelector("#map-home"),{osm:a,esri:o}={osm:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}),esri:L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Â© Esri"})},r=L.map(n,{center:[-2.5,118],zoom:4,layers:[a]});if(L.control.layers({OSM:a,Satelit:o}).addTo(r),requestAnimationFrame(()=>r.invalidateSize()),window.addEventListener("resize",()=>r.invalidateSize(),{passive:!0}),!t)return e;let i=[];const s=e.querySelector("#offlineBanner");try{const{listStory:e=[]}=await S.list({withLocation:!0});i=e,i.length&&await async function(e){const t=(await E()).transaction("stories","readwrite"),n=t.objectStore("stories");for(const t of e)await n.put(t);await(t.done?.catch?.(()=>{}))}(i)}catch{i=await async function(){const e=await E();return new Promise((t,n)=>{const a=e.transaction("stories","readonly").objectStore("stories").getAll();a.onsuccess=()=>t(a.result||[]),a.onerror=()=>n(a.error)})}(),i.length&&(s.style.display="block")}const l=e.querySelector("#list"),c=L.featureGroup().addTo(r),d=new Map;function p(e){l.innerHTML="",e.forEach(e=>{const t=document.createElement("article");t.className="card";const n=e.createdAt?new Date(e.createdAt).toLocaleString("id-ID"):"";t.innerHTML=`\n        <img src="${e.photoUrl}" alt="Foto story oleh ${e.name}" loading="lazy" />\n        <h2>${e.name||"Tanpa nama"}</h2>\n        <p>${e.description||""}</p>\n        <small>${n}</small>\n        <div style="display:flex;gap:8px;flex-wrap:wrap">\n          <button class="btn" type="button" data-focus="${e.id}">Fokus di peta</button>\n          <button class="btn" type="button" data-open="${e.id}">Buka popup</button>\n          <button class="btn" type="button" data-del="${e.id}" aria-label="Hapus dari penyimpanan lokal">Hapus Lokal</button>\n        </div>\n      `,l.appendChild(t),t.querySelector(`[data-focus="${e.id}"]`)?.addEventListener("click",()=>{const n=d.get(e.id);n&&(r.setView(n.getLatLng(),Math.max(r.getZoom(),8)),n.openPopup()),t.scrollIntoView({behavior:"smooth",block:"center"})}),t.querySelector(`[data-open="${e.id}"]`)?.addEventListener("click",()=>{const t=d.get(e.id);t&&t.openPopup()}),t.querySelector(`[data-del="${e.id}"]`)?.addEventListener("click",async()=>{await async function(e){const t=(await E()).transaction("stories","readwrite");return t.objectStore("stories").delete(e),t.done?.catch?.(()=>{})}(e.id),t.remove();const n=d.get(e.id);n&&(c.removeLayer(n),d.delete(e.id))})})}i.forEach(e=>{if(null!=e.lat&&null!=e.lon){const t=L.marker([e.lat,e.lon]).bindPopup(`\n        <strong>${e.name||"Tanpa nama"}</strong><br/>\n        ${e.description||""}\n      `);t.addTo(c),d.set(e.id,t),t.on("click",()=>{const t=l.querySelector(`[data-open="${e.id}"]`)?.closest(".card");t&&t.classList.add("active")}),t.on("popupclose",()=>{const t=l.querySelector(`[data-open="${e.id}"]`)?.closest(".card");t&&t.classList.remove("active")})}}),c.getLayers().length&&(r.fitBounds(c.getBounds().pad(.2)),setTimeout(()=>r.invalidateSize(),0)),p(i);const u=e.querySelector("#q");return u.addEventListener("input",()=>{const e=u.value.trim().toLowerCase(),t=e?i.filter(t=>(t.name||"").toLowerCase().includes(e)||(t.description||"").toLowerCase().includes(e)):i;p(t),c.clearLayers(),t.forEach(e=>{const t=d.get(e.id);t&&t.addTo(c)}),c.getLayers().length?r.fitBounds(c.getBounds().pad(.2)):r.setView([-2.5,118],4),requestAnimationFrame(()=>r.invalidateSize())}),e}function I(){const e=document.createElement("section");return e.innerHTML="<h1>Tentang</h1><p>SPA dengan hash routing, view transition, dan peta Leaflet.</p>",e}function j(){const e=document.createElement("section");e.innerHTML='\n    <h1>Masuk</h1>\n    <form class="form" id="login" novalidate>\n      <label for="email">Email</label>\n      <input id="email" type="email" autocomplete="email" required />\n\n      <label for="password">Kata sandi</label>\n      <input id="password" type="password" minlength="8" required />\n\n      <button type="submit">Login</button>\n      <p class="error" id="err" aria-live="polite"></p>\n      <p class="success" id="success" aria-live="polite"></p>\n    </form>\n  ';const t=e.querySelector("#login"),n=e.querySelector("#err"),a=e.querySelector("#success");return t.addEventListener("submit",async t=>{t.preventDefault(),n.textContent="",a.textContent="";const o=e.querySelector("#email").value.trim(),r=e.querySelector("#password").value;try{const e=await k({email:o,password:r});if(e.error)return void(n.textContent=e.message||"Login gagal. Periksa kembali email dan kata sandi.");localStorage.setItem("token",e.loginResult.token),localStorage.setItem("name",e.loginResult.name),a.textContent=`Login berhasil! Selamat datang, ${e.loginResult.name}! ðŸŽ‰`,window.updateAuthUI&&window.updateAuthUI(),setTimeout(()=>{"#/home"!==location.hash?location.hash="#/home":window.dispatchEvent(new HashChangeEvent("hashchange"))},1200)}catch(e){n.textContent="Terjadi kesalahan jaringan. Coba lagi nanti.",console.error(e)}}),e}function M(){const e=document.createElement("section");return e.innerHTML='\n<h1>Daftar</h1>\n<form class="form" id="reg" novalidate>\n  <label for="name">Nama</label>\n  <input id="name" required />\n\n  <label for="email">Email</label>\n  <input id="email" type="email" required />\n\n  <label for="password">Kata sandi (â‰¥8)</label>\n  <input id="password" type="password" minlength="8" required />\n\n  <button type="submit">Buat Akun</button>\n  <p class="success" id="ok" aria-live="polite"></p>\n  <p class="error" id="err" aria-live="polite"></p>\n</form>\n',e.querySelector("#reg").addEventListener("submit",async t=>{t.preventDefault();const n=e.querySelector("#name").value.trim(),a=e.querySelector("#email").value.trim(),o=e.querySelector("#password").value,r=e.querySelector("#ok"),i=e.querySelector("#err");r.textContent="",i.textContent="";const s=await x({name:n,email:a,password:o});s.error?i.textContent=s.message||"Gagal daftar":r.textContent="Akun dibuat. Silakan login."}),e}async function B(e=!0){const t=await C();if(t.length){for(const e of t)try{if(!(await S.create({description:e.description,photoFile:e.photoFile,lat:e.lat,lon:e.lon,guest:e.guest})).error&&(await T(e.id),navigator.serviceWorker?.controller)){const t=await navigator.serviceWorker.getRegistration();await(t?.showNotification("Story terkirim",{body:e.description?.slice(0,90)||"Berhasil mengirim story.",icon:"/icons/icon-192.png",badge:"/icons/badge.png",data:{go:"#/home"},actions:[{action:"open",title:"Lihat di Home"}]}))}}catch(e){}if(e){const e=document.createElement("p");e.className="success",e.textContent="Sinkronisasi offline selesai (jika ada item).",document.getElementById("main-content")?.prepend(e),setTimeout(()=>e.remove(),2500)}}}function P(){const e=document.createElement("section");e.innerHTML='\n    <h1>Tambah Story</h1>\n    <p class="hint">Klik peta untuk mengisi koordinat. Bisa unggah foto atau ambil dari kamera.</p>\n\n    <div id="map" class="map" aria-label="Pilih lokasi di peta"></div>\n\n    <form class="form" id="form" novalidate>\n      <label for="desc">Deskripsi</label>\n      <textarea id="desc" required rows="3" placeholder="Tulis deskripsi..."></textarea>\n\n      <label for="photo">Foto (â‰¤1MB)</label>\n      <input id="photo" type="file" accept="image/*" required />\n\n      <div class="row-2">\n        <div>\n          <label for="lat">Latitude</label>\n          <input id="lat" type="number" step="any" readonly />\n        </div>\n        <div>\n          <label for="lon">Longitude</label>\n          <input id="lon" type="number" step="any" readonly />\n        </div>\n      </div>\n\n      <details>\n        <summary>Ambil foto dari kamera</summary>\n        <video id="cam" autoplay playsinline style="width:100%;max-height:240px;border-radius:8px"></video>\n        <div style="display:flex;gap:8px;margin:8px 0;">\n          <button id="startCam" type="button">Mulai Kamera</button>\n          <button id="capture" type="button">Ambil Gambar</button>\n          <button id="stopCam" type="button">Matikan Kamera</button>\n        </div>\n        <canvas id="canvas" width="640" height="480" hidden></canvas>\n      </details>\n\n      <label for="guest" style="display:inline-flex;align-items:center;gap:8px;">\n        <input type="checkbox" id="guest" /> Kirim sebagai tamu (tanpa login)\n      </label>\n\n      <button type="submit" id="submitBtn">Kirim</button>\n      <p class="success" id="ok" aria-live="polite"></p>\n      <p class="error" id="err" aria-live="polite"></p>\n    </form>\n  ';const t=L.map(e.querySelector("#map"),{center:[-2.5,118],zoom:4});let n,a;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}).addTo(t),function(e){return new Promise(t=>{if(document.body.contains(e))return t();const n=new MutationObserver(()=>{document.body.contains(e)&&(n.disconnect(),t())});n.observe(document.body,{childList:!0,subtree:!0})})}(e).then(()=>setTimeout(()=>t.invalidateSize(),0)),window.addEventListener("resize",()=>t.invalidateSize(),{passive:!0}),t.on("click",({latlng:{lat:a,lng:o}})=>{e.querySelector("#lat").value=Number(a).toFixed(6),e.querySelector("#lon").value=Number(o).toFixed(6),n?n.setLatLng([a,o]):n=L.marker([a,o]).addTo(t)});const o=e.querySelector("#cam"),r=e.querySelector("#canvas");e.querySelector("#startCam").addEventListener("click",async()=>{try{a=await navigator.mediaDevices.getUserMedia({video:!0}),o.srcObject=a}catch{alert("Tidak bisa mengakses kamera.")}});const i=()=>{a&&(a.getTracks().forEach(e=>e.stop()),a=null,o.srcObject=null)};return e.querySelector("#stopCam").addEventListener("click",i),window.addEventListener("hashchange",i,{once:!0}),e.querySelector("#capture").addEventListener("click",()=>{o.srcObject&&(r.hidden=!1,r.getContext("2d").drawImage(o,0,0,r.width,r.height),r.toBlob(t=>{const n=new File([t],"camera.jpg",{type:t.type||"image/jpeg"}),a=new DataTransfer;a.items.add(n),e.querySelector("#photo").files=a.files},"image/jpeg",.9))}),e.querySelector("#form").addEventListener("submit",async t=>{t.preventDefault();const n=e.querySelector("#desc").value.trim(),a=e.querySelector("#photo").files[0],o=e.querySelector("#lat").value,r=e.querySelector("#lon").value,i=o?parseFloat(o):void 0,s=r?parseFloat(r):void 0,l=e.querySelector("#guest").checked,c=e.querySelector("#err"),d=e.querySelector("#ok"),p=e.querySelector("#submitBtn");if(c.textContent="",d.textContent="",!n)return c.textContent="Deskripsi wajib.";if(!a)return c.textContent="Foto wajib.";if(a.size>1048576)return c.textContent="Ukuran foto > 1MB.";p.disabled=!0;try{const e=await S.create({description:n,photoFile:a,lat:i,lon:s,guest:l});if(e.error)throw new Error(e.message||"Gagal membuat story");if(d.textContent="Story berhasil dibuat!",navigator.serviceWorker){const e=await navigator.serviceWorker.getRegistration();await(e?.showNotification("Story berhasil",{body:n.slice(0,90),icon:"/icons/icon-192.png",badge:"/icons/badge.png",data:{go:"#/home"},actions:[{action:"open",title:"Lihat di Home"}]}))}location.hash="#/home"}catch(e){try{await async function(e){const t=(await E()).transaction("outbox","readwrite");await t.objectStore("outbox").add(e),await(t.done?.catch?.(()=>{}))}({description:n,photoFile:a,lat:i,lon:s,guest:l,createdAt:Date.now()}),d.textContent="Tidak ada koneksi. Story disimpan offline dan akan dikirim otomatis saat online.";try{const e=await(navigator.serviceWorker?.getRegistration());await(e?.sync?.register("sync-outbox"))}catch{}}catch{c.textContent="Gagal menyimpan ke penyimpanan offline."}}finally{p.disabled=!1}}),navigator.onLine&&B(!1),window.addEventListener("online",()=>B()),e}function z(){const e={"/home":A,"/about":I,"/login":j,"/register":M,"/add-story":P},t=location.hash.replace(/^#/,"")||"/home",n=document.getElementById("main-content");n.innerHTML="";const a=e[t]||A;a().then?.(e=>n.appendChild(e))||n.appendChild(a()),document.startViewTransition&&document.startViewTransition(()=>{})}async function O(){return"serviceWorker"in navigator?await navigator.serviceWorker.register("/sw.js"):null}function F(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=atob(t),a=new Uint8Array(n.length);for(let e=0;e<n.length;e++)a[e]=n.charCodeAt(e);return a}async function $(){const e=await O();return e?.pushManager.getSubscription()}let N=null;async function D(){const e=!!localStorage.getItem("token");document.body.classList.toggle("auth",e),document.body.classList.toggle("guest",!e);const t=document.querySelector("[data-nav-guest]"),n=document.querySelector("[data-nav-auth]");t&&(t.hidden=e),n&&(n.hidden=!e);const a=document.getElementById("btn-push");if(a){const t=await $();a.textContent=t?"Disable Push":"Enable Push",a.disabled=!e}window.updateAuthUI=D}async function H(){try{const e=await C();if(!e?.length)return;for(const t of e)try{await S.create({description:t.description,photoFile:t.photoFile,lat:t.lat,lon:t.lon,guest:t.guest}),await T(t.id)}catch{}}catch{}}!function(){const e=document.getElementById("year");e&&(e.textContent=(new Date).getFullYear()),D(),function(){const e=document.getElementById("btn-push");e&&e.addEventListener("click",async()=>{try{await $()?await async function(){const e=await O(),t=await(e?.pushManager.getSubscription());if(t){try{await fetch(`${y}/push/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify(await t.toJSON())})}catch{}await t.unsubscribe()}}():await async function(){if(!("Notification"in window))throw new Error("Browser tidak mendukung notifikasi.");if("granted"!==await Notification.requestPermission())throw new Error("Izin notifikasi ditolak.");const e=await O(),t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:F(b)});try{await fetch(`${y}/push/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify(await t.toJSON())})}catch{}return t}(),D(),alert("Pengaturan push diperbarui.")}catch(e){alert(e?.message||"Gagal mengatur push notification.")}})}(),function(){const e=document.getElementById("btn-install");window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),N=t,e&&(e.hidden=!1)}),e&&e.addEventListener("click",async()=>{N&&(N.prompt(),await N.userChoice,N=null,e.hidden=!0)})}(),window.addEventListener("hashchange",()=>{z(),D()}),z();const t=document.querySelector(".skip-link");t&&t.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("main-content");t&&(t.setAttribute("tabindex","-1"),t.focus({preventScroll:!1}))}),document.querySelector("[data-logout]")?.addEventListener("click",e=>{e.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("name"),D(),location.hash="#/home"}),O().catch(()=>{}),navigator.serviceWorker?.addEventListener?.("message",e=>{"NAVIGATE"===e.data?.type&&"string"==typeof e.data.hash&&(location.hash=e.data.url.replace(location.origin,"")),"FLUSH_OUTBOX"===e.data?.type&&H()}),window.addEventListener("online",H),H()}()})();