(()=>{"use strict";var n={56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,a=0;a<e.length;a++)if(e[a].identifier===n){t=a;break}return t}function a(n,a){for(var o={},i=[],s=0;s<n.length;s++){var l=n[s],c=a.base?l[0]+a.base:l[0],d=o[c]||0,p="".concat(c," ").concat(d);o[c]=d+1;var u=t(p),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var h=r(m,a);a.byIndex=s,e.splice(s,0,{identifier:p,updater:h,references:1})}i.push(p)}return i}function r(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,r){var o=a(n=n||[],r=r||{});return function(n){n=n||[];for(var i=0;i<o.length;i++){var s=t(o[i]);e[s].references--}for(var l=a(n,r),c=0;c<o.length;c++){var d=t(o[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}o=l}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},159:(n,e,t)=>{t.d(e,{A:()=>s});var a=t(601),r=t.n(a),o=t(314),i=t.n(o)()(r());i.push([n.id,'/* ===============================\n   Story SPA â€“ Clean Base Styles\n   =============================== */\n\n/* ---------- Theme & Tokens ---------- */\n:root {\n  --bg: #ffffff;\n  --fg: #0b1020;\n  --muted: #6b7280;\n  --primary: #2563eb;\n  --primary-ink: #ffffff;\n  --surface: #f8fafc;\n  --border: #e5e7eb;\n  --radius: 12px;\n  --shadow: 0 10px 20px rgba(2, 6, 23, .06), 0 2px 6px rgba(2, 6, 23, .06);\n  --maxw: 1100px;\n}\n\n/* ---------- Reset ringan ---------- */\n* { box-sizing: border-box; }\nhtml, body { height: 100%; }\n\nbody {\n  margin: 0;\n  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;\n  color: var(--fg);\n  background: var(--bg);\n}\n\n/* ---------- A11y: skip link & focus ---------- */\n.skip-link {\n  position: absolute;\n  left: -9999px;\n  top: 0;\n  background: #111;\n  color: #fff;\n  padding: 8px 12px;\n  border-radius: 8px;\n}\n.skip-link:focus {\n  left: 12px;\n  top: 12px;\n  z-index: 1000;\n}\n:focus { outline: none; }\n:focus-visible {\n  outline: 3px solid var(--primary);\n  outline-offset: 2px;\n}\n\n/* ---------- Layout helpers ---------- */\n.container {\n  max-width: var(--maxw);\n  margin-inline: auto;\n  padding: clamp(16px, 1.5vw, 24px);\n}\nmain { min-height: 70vh; }\nfooter {\n  border-top: 1px solid var(--border);\n  padding: 16px;\n  color: var(--muted);\n}\n\n/* ---------- Typography ---------- */\nh1 {\n  font-size: clamp(28px, 3.6vw, 40px);\n  margin: 24px 0 16px;\n}\nh2 {\n  font-size: clamp(18px, 2.2vw, 22px);\n  margin: 12px 0 8px;\n}\n\n/* ===============================\n   Header & Navigation\n   =============================== */\n@view-transition { navigation: auto; }\n::view-transition-old(root),\n::view-transition-new(root) { animation-duration: .18s; }\n\nheader {\n  position: static;\n  top: 0;\n  z-index: 100;\n  background: rgba(255,255,255,.9);\n  backdrop-filter: saturate(180%) blur(12px);\n  border-bottom: 1px solid var(--border);\n  box-shadow: 0 1px 4px rgba(0,0,0,.05);\n}\nheader nav {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  flex-wrap: wrap;\n  max-width: var(--maxw);\n  margin: 0 auto;\n  padding: 12px 20px;\n}\n.nav-left {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 700;\n  font-size: 18px;\n}\n.nav-right {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\nheader a {\n  color: var(--fg);\n  text-decoration: none;\n  font-weight: 600;\n  padding: 6px 10px;\n  border-radius: 8px;\n  transition: background .2s, color .2s;\n}\nheader a:hover {\n  background: var(--primary);\n  color: var(--primary-ink);\n}\n\nheader .btn-primary {\n  background: var(--primary);\n  color: var(--primary-ink);\n  border: none;\n  border-radius: 999px;\n  padding: 8px 16px;\n  font-weight: 700;\n  cursor: pointer;\n  transition: background .2s, transform .1s;\n  box-shadow: 0 6px 14px rgba(37,99,235,.25);\n}\nheader .btn-primary:hover {\n  background: #1d4ed8;\n  transform: translateY(-1px);\n}\nheader .btn-primary:active {\n  transform: translateY(1px);\n}\n\nheader .btn-secondary {\n  background: transparent;\n  color: var(--primary);\n  border: 2px solid var(--primary);\n  border-radius: 999px;\n  padding: 6px 14px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: background .2s, color .2s;\n}\nheader .btn-secondary:hover {\n  background: var(--primary);\n  color: var(--primary-ink);\n}\n\n@media (max-width: 640px) {\n  header nav {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 8px;\n  }\n  .nav-right { flex-wrap: wrap; }\n}\n\n/* ---------- pesan sukses / error ---------- */\n.success {\n  color: #059669;\n  font-weight: 600;\n  margin-top: 8px;\n  animation: fadeIn 0.4s ease;\n}\n.error {\n  color: #dc2626;\n  font-weight: 600;\n  margin-top: 8px;\n  animation: fadeIn 0.4s ease;\n}\n.hint { color: var(--muted); }\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(-3px); }\n  to   { opacity: 1; transform: translateY(0); }\n}\n\n/* ===============================\n   Cards & Lists\n   =============================== */\n.card {\n  background: var(--surface);\n  border: 1px solid var(--border);\n  border-radius: var(--radius);\n  padding: 14px;\n  box-shadow: var(--shadow);\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n.list {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n  gap: 16px;\n  margin-top: 16px;\n}\n.card img {\n  width: 100%;\n  height: auto;\n  border-radius: 10px;\n  object-fit: cover;\n}\n\n/* ===============================\n   Map (Leaflet)\n   =============================== */\n\n/* wrapper umum semua map */\n.map,\n#map,\n#map-home {\n  width: 100%;\n  height: 100%;\n  min-height: 420px;                 /* tinggi minimal */\n  border-radius: var(--radius);\n  overflow: hidden;\n  background: #e5eef4;               /* warna dasar saat tiles belum load */\n  box-shadow: var(--shadow);\n}\n\n/* map di halaman Home (dalam kolom kanan) */\n.map-home {\n  min-height: 480px;\n}\n\n/* map di halaman Add Story â€“ sedikit lebih tinggi */\n.map-add {\n  min-height: 520px;\n}\n\n/* biar control layer kelihatan lebih lembut */\n.leaflet-control-layers {\n  border-radius: 10px !important;\n  overflow: hidden;\n}\n\n/* Marker style ala â€œGMapsâ€ (tanpa ganti icon JS) */\n.leaflet-marker-icon {\n  filter: drop-shadow(0 8px 12px rgba(15,23,42,.35));\n  transition: transform .12s ease, filter .12s ease;\n}\n.leaflet-marker-icon.leaflet-interactive:hover {\n  transform: translateY(-2px) scale(1.03);\n  filter: drop-shadow(0 10px 16px rgba(15,23,42,.45));\n}\n\n/* popup yang lebih lembut */\n.leaflet-popup-content-wrapper {\n  border-radius: 12px;\n  box-shadow: 0 14px 30px rgba(15,23,42,.25);\n}\n.leaflet-popup-tip {\n  filter: drop-shadow(0 4px 8px rgba(15,23,42,.2));\n}\n\n/* ===============================\n   Forms\n   =============================== */\nform.form {\n  display: grid;\n  gap: 10px;\n  background: var(--surface);\n  border: 1px solid var(--border);\n  border-radius: var(--radius);\n  padding: 16px;\n  box-shadow: var(--shadow);\n  margin-top: 16px;\n}\nlabel {\n  font-weight: 600;\n  color: #111;\n}\ninput,\ntextarea,\nselect {\n  width: 100%;\n  border: 1px solid var(--border);\n  border-radius: 10px;\n  padding: 10px 12px;\n  font: inherit;\n  background: #fff;\n}\ntextarea {\n  resize: vertical;\n  min-height: 92px;\n}\ninput:focus-visible,\ntextarea:focus-visible {\n  border-color: var(--primary);\n}\n\n.row-2 {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 10px;\n}\n@media (max-width: 540px) {\n  .row-2 { grid-template-columns: 1fr; }\n}\n\nbutton,\n.btn {\n  appearance: none;\n  border: 0;\n  border-radius: 999px;\n  background: var(--primary);\n  color: var(--primary-ink);\n  padding: 10px 16px;\n  font-weight: 700;\n  cursor: pointer;\n  box-shadow: 0 6px 14px rgba(37,99,235,.25);\n  transition: transform .06s ease, filter .06s ease, background .06s ease;\n}\nbutton:hover { filter: brightness(1.05); }\nbutton:active { transform: translateY(1px); }\nbutton[disabled] {\n  opacity: .6;\n  cursor: not-allowed;\n  box-shadow: none;\n}\n\n/* ---------- Auth visibility helpers ---------- */\n.guest-only,\n.auth-only { display: none; }\nbody.guest .guest-only { display: inline; }\nbody.auth  .auth-only  { display: inline; }\n\n/* ---------- Reduced motion ---------- */\n@media (prefers-reduced-motion: reduce) {\n  * { animation: none !important; transition: none !important; }\n  body.guest .auth-only  { display: none !important; }\n  body.auth  .guest-only { display: none !important; }\n}\n\n/* ===============================\n   Home layout seperti contoh\n   =============================== */\n\n.page-home {\n  display: flex;\n  flex-direction: column;\n  gap: 18px;\n}\n\n/* header teks + tabs */\n.home-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-end;\n  gap: 12px;\n}\n\n.home-eyebrow {\n  font-size: 12px;\n  letter-spacing: .08em;\n  text-transform: uppercase;\n  color: var(--muted);\n  margin: 0 0 4px;\n}\n\n.home-title {\n  margin: 0;\n}\n\n.home-tabs {\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n}\n\n/* chip-style button */\n.chip {\n  border-radius: 999px;\n  border: 1px solid var(--border);\n  padding: 6px 14px;\n  background: #fff;\n  color: var(--fg);\n  font-size: 13px;\n  cursor: pointer;\n  transition: background .18s ease, color .18s ease, box-shadow .18s ease, transform .12s ease;\n}\n.chip:hover {\n  transform: translateY(-1px);\n  box-shadow: 0 8px 16px rgba(15,23,42,.12);\n}\n.chip-primary,\n.chip--active {\n  background: var(--primary);\n  color: var(--primary-ink);\n  border-color: var(--primary);\n}\n\n/* layout list kiri, map kanan */\n.layout-stories {\n  display: grid;\n  grid-template-columns: minmax(260px, 320px) minmax(0, 1fr); /* sidebar kiri + map penuh kanan */\n  gap: 16px;\n  align-items: stretch;\n  transition: grid-template-columns .22s ease;\n}\n\n/* panel kiri (filter + daftar) */\n.stories-list {\n  max-height: 520px;\n  overflow: auto;\n  transition: opacity .22s ease, transform .22s ease;\n}\n\n/* panel kanan (map) */\n.stories-map {\n  min-height: 520px;\n  transition: opacity .22s ease, transform .22s ease, min-height .22s ease;\n}\n\n/* map di dalam panel kanan isi penuh kolom */\n.stories-map .map-home {\n  width: 100%;\n  height: 100%;\n  min-height: 520px;\n}\n\n/* list vertikal ala sidebar */\n.list-vertical {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n\n/* kartu kecil untuk sidebar */\n.card-compact {\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  gap: 10px;\n}\n\n.card-thumb img {\n  width: 56px;\n  height: 56px;\n  border-radius: 10px;\n  object-fit: cover;\n}\n\n.card-body {\n  flex: 1;\n}\n\n.card-title {\n  margin: 0 0 4px;\n  font-size: 14px;\n}\n\n.card-desc {\n  margin: 0 0 4px;\n  font-size: 13px;\n  color: var(--muted);\n}\n\n.card-meta {\n  font-size: 11px;\n  color: var(--muted);\n}\n\n/* highlight kartu aktif (marker popup terbuka) */\n.card-active {\n  outline: 2px solid var(--primary);\n  outline-offset: 2px;\n  background: #eff6ff;\n}\n\n/* hint guest */\n.home-hint {\n  margin-top: 8px;\n  color: var(--muted);\n}\n\n/* ===============================\n   Mode â€œLihat Petaâ€ â€“ Map fullscreen\n   =============================== */\n\n/* class ini kamu tambahkan ke .layout-stories dari JS saat tab "Lihat Peta" diklik */\n.layout-stories--map-only {\n  grid-template-columns: minmax(0, 1fr);    /* cuma kolom map */\n}\n\n/* sembunyikan list dengan animasi */\n.layout-stories--map-only .stories-list {\n  opacity: 0;\n  pointer-events: none;\n  transform: translateX(-12px);\n}\n\n/* map melebar penuh + sedikit lebih tinggi */\n.layout-stories--map-only .stories-map {\n  min-height: 560px;\n  transform: translateX(0);\n}\n\n/* tab aktif untuk "Lihat Peta" bisa pakai .chip--active di button-nya */\n\n/* responsif: di mobile map di atas list */\n@media (max-width: 768px) {\n  .layout-stories {\n    grid-template-columns: minmax(0, 1fr);\n  }\n  .stories-map {\n    order: 1;\n    min-height: 360px;\n  }\n  .stories-map .map-home {\n    min-height: 360px;\n  }\n  .stories-list {\n    order: 2;\n    max-height: none;\n  }\n}',""]);const s=i},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t="",a=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),a&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),a&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t}).join("")},e.i=function(n,t,a,r,o){"string"==typeof n&&(n=[[null,n,void 0]]);var i={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(i[l]=!0)}for(var c=0;c<n.length;c++){var d=[].concat(n[c]);a&&i[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),e.push(d))}},e}},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var a=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var a="";t.supports&&(a+="@supports (".concat(t.supports,") {")),t.media&&(a+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(a+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),a+=t.css,r&&(a+="}"),t.media&&(a+="}"),t.supports&&(a+="}");var o=t.sourceMap;o&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),e.styleTagTransform(a,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(a){var r=e[a];if(void 0!==r)return r.exports;var o=e[a]={id:a,exports:{}};return n[a](o,o.exports,t),o.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var a in e)t.o(e,a)&&!t.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:e[a]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0;var a=t(72),r=t.n(a),o=t(825),i=t.n(o),s=t(659),l=t.n(s),c=t(56),d=t.n(c),p=t(540),u=t.n(p),m=t(113),h=t.n(m),f=t(159),g={};g.styleTagTransform=h(),g.setAttributes=d(),g.insert=l().bind(null,"head"),g.domAPI=i(),g.insertStyleElement=u(),r()(f.A,g),f.A&&f.A.locals&&f.A.locals;const y="https://story-api.dicoding.dev/v1",b="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",v=y,x=()=>{const n=localStorage.getItem("token");return n?{Authorization:`Bearer ${n}`}:{}},w=async({name:n,email:e,password:t})=>(await fetch(`${v}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,email:e,password:t})})).json(),k=async({email:n,password:e})=>(await fetch(`${v}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e})})).json(),S={async list({page:n=1,size:e=20,withLocation:t=!0}={}){const a=new URL(`${v}/stories`);return a.searchParams.set("page",n),a.searchParams.set("size",e),a.searchParams.set("location",t?1:0),(await fetch(a,{headers:{...x()}})).json()},async create({description:n,photoFile:e,lat:t,lon:a,guest:r=!1}){const o=new FormData;o.append("description",n),o.append("photo",e),null!=t&&o.append("lat",t),null!=a&&o.append("lon",a);const i=r?`${v}/stories/guest`:`${v}/stories`;return(await fetch(i,{method:"POST",headers:r?{}:{...x()},body:o})).json()}};let q;function E(){return new Promise((n,e)=>{if(q)return n(q);const t=indexedDB.open("story-spa",2);t.onupgradeneeded=n=>{const e=n.target.result;e.objectStoreNames.contains("stories")||e.createObjectStore("stories",{keyPath:"id"}),e.objectStoreNames.contains("outbox")||e.createObjectStore("outbox",{keyPath:"id",autoIncrement:!0})},t.onsuccess=()=>{q=t.result,n(q)},t.onerror=()=>e(t.error)})}async function C(){const n=await E();return new Promise((e,t)=>{const a=n.transaction("outbox","readonly").objectStore("outbox").getAll();a.onsuccess=()=>e(a.result||[]),a.onerror=()=>t(a.error)})}async function T(n){const e=(await E()).transaction("outbox","readwrite");return e.objectStore("outbox").delete(n),e.done?.catch?.(()=>{})}async function A(){const n=document.createElement("section");n.className="page-home",n.innerHTML='\n    <header class="home-header">\n      <div>\n        <p class="home-eyebrow">Cerita</p>\n        <h1 class="home-title">Kumpulan Cerita</h1>\n      </div>\n      <div class="home-tabs">\n        <button type="button" class="chip chip-primary" data-view="all" aria-pressed="true">\n          Semua Cerita\n        </button>\n        <button type="button" class="chip" data-view="list" aria-pressed="false">\n          Daftar\n        </button>\n        <button type="button" class="chip" data-view="map" aria-pressed="false">\n          Lihat Peta\n        </button>\n      </div>\n    </header>\n\n    \x3c!-- Banner offline --\x3e\n    <p id="offlineBanner" class="hint home-hint" style="display:none" aria-live="polite">\n      Mode offline: menampilkan data lokal yang tersimpan.\n    </p>\n\n    <div class="layout-stories" aria-label="Cerita dan peta">\n      <aside class="stories-list" aria-label="Daftar story">\n        <form class="form" role="search" aria-label="Filter story" style="margin-bottom:12px">\n          <label for="q">Cari story (nama/teks)</label>\n          <input\n            id="q"\n            type="search"\n            placeholder="Ketik untuk memfilter..."\n            autocomplete="off"\n          />\n        </form>\n        <div id="list" class="list list-vertical" aria-live="polite"></div>\n      </aside>\n\n      <section class="stories-map" aria-label="Peta lokasi story">\n        <div id="map-home" class="map map-home"></div>\n      </section>\n    </div>\n\n    <p class="guest-only home-hint">\n      Untuk melihat data dari API, silakan <a href="#/login">login</a>.\n    </p>\n  ';const e=localStorage.getItem("token"),t=n.querySelector(".layout-stories"),a=n.querySelector("#map-home"),{osm:r,esri:o}={osm:L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}),esri:L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Â© Esri"})},i=L.map(a,{center:[-2.5,118],zoom:4,layers:[r]});if(L.control.layers({OSM:r,Satelit:o}).addTo(i),requestAnimationFrame(()=>i.invalidateSize()),window.addEventListener("resize",()=>i.invalidateSize(),{passive:!0}),!e)return t.hidden=!0,n;t.hidden=!1;let s=[];const l=n.querySelector("#offlineBanner");try{const{listStory:n=[]}=await S.list({withLocation:!0});s=n,s.length&&await async function(n){const e=(await E()).transaction("stories","readwrite"),t=e.objectStore("stories");for(const e of n)await t.put(e);await(e.done?.catch?.(()=>{}))}(s)}catch{s=await async function(){const n=await E();return new Promise((e,t)=>{const a=n.transaction("stories","readonly").objectStore("stories").getAll();a.onsuccess=()=>e(a.result||[]),a.onerror=()=>t(a.error)})}(),s.length&&(l.style.display="block")}const c=n.querySelector("#list"),d=L.featureGroup().addTo(i),p=new Map;function u(n){c.innerHTML="",n.forEach(n=>{const e=n.createdAt?new Date(n.createdAt).toLocaleString("id-ID"):"",t=document.createElement("article");t.className="card card-compact",t.dataset.id=n.id,t.innerHTML=`\n        <div class="card-thumb">\n          <img src="${n.photoUrl}" alt="Foto story oleh ${n.name||"Tanpa nama"}" loading="lazy" />\n        </div>\n        <div class="card-body">\n          <h2 class="card-title">${n.name||"Tanpa nama"}</h2>\n          <p class="card-desc">${n.description||""}</p>\n          <small class="card-meta">${e}</small>\n          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;">\n            <button class="btn" type="button" data-focus="${n.id}">Fokus peta</button>\n            <button class="btn" type="button" data-open="${n.id}">Buka popup</button>\n            <button class="btn" type="button" data-del="${n.id}"\n              aria-label="Hapus dari penyimpanan lokal">\n              Hapus Lokal\n            </button>\n          </div>\n        </div>\n      `,c.appendChild(t),t.querySelector(`[data-focus="${n.id}"]`)?.addEventListener("click",()=>{const e=p.get(n.id);e&&(i.setView(e.getLatLng(),Math.max(i.getZoom(),8)),e.openPopup()),t.scrollIntoView({behavior:"smooth",block:"center"})}),t.querySelector(`[data-open="${n.id}"]`)?.addEventListener("click",()=>{const e=p.get(n.id);e&&e.openPopup()}),t.querySelector(`[data-del="${n.id}"]`)?.addEventListener("click",async()=>{await async function(n){const e=(await E()).transaction("stories","readwrite");return e.objectStore("stories").delete(n),e.done?.catch?.(()=>{})}(n.id),t.remove();const e=p.get(n.id);e&&(d.removeLayer(e),p.delete(n.id))})})}s.forEach(n=>{if(null!=n.lat&&null!=n.lon){const e=L.marker([n.lat,n.lon]).bindPopup(`\n          <strong>${n.name||"Tanpa nama"}</strong><br/>\n          ${n.description||""}\n        `);e.addTo(d),p.set(n.id,e),e.on("popupopen",()=>{const e=c.querySelector(`[data-id="${n.id}"]`);e&&e.classList.add("card-active")}),e.on("popupclose",()=>{const e=c.querySelector(`[data-id="${n.id}"]`);e&&e.classList.remove("card-active")})}}),d.getLayers().length&&(i.fitBounds(d.getBounds().pad(.2)),setTimeout(()=>i.invalidateSize(),0)),u(s);const m=n.querySelector("#q");m.addEventListener("input",()=>{const n=m.value.trim().toLowerCase(),e=n?s.filter(e=>(e.name||"").toLowerCase().includes(n)||(e.description||"").toLowerCase().includes(n)):s;u(e),d.clearLayers(),e.forEach(n=>{const e=p.get(n.id);e&&e.addTo(d)}),d.getLayers().length?i.fitBounds(d.getBounds().pad(.2)):i.setView([-2.5,118],4),requestAnimationFrame(()=>i.invalidateSize())});const h=n.querySelectorAll(".home-tabs .chip");return h.forEach(e=>{e.addEventListener("click",()=>(e=>{h.forEach(n=>{const t=n.dataset.view===e||"all"===e&&"all"===n.dataset.view;n.classList.toggle("chip-primary",t),n.setAttribute("aria-pressed",t?"true":"false")});const t=n.querySelector(".stories-list"),a=n.querySelector(".stories-map");"list"===e?(t.style.display="block",a.style.display="none"):"map"===e?(t.style.display="none",a.style.display="block",i.invalidateSize()):(t.style.display="",a.style.display="",i.invalidateSize())})(e.dataset.view))}),n}function M(){const n=document.createElement("section");return n.innerHTML="<h1>Tentang</h1><p>SPA dengan hash routing, view transition, dan peta Leaflet.</p>",n}function I(){const n=document.createElement("section");n.innerHTML='\n    <h1>Masuk</h1>\n    <form class="form" id="login" novalidate>\n      <label for="email">Email</label>\n      <input id="email" type="email" autocomplete="email" required />\n\n      <label for="password">Kata sandi</label>\n      <input id="password" type="password" minlength="8" required />\n\n      <button type="submit">Login</button>\n      <p class="error" id="err" aria-live="polite"></p>\n      <p class="success" id="success" aria-live="polite"></p>\n    </form>\n  ';const e=n.querySelector("#login"),t=n.querySelector("#err"),a=n.querySelector("#success");return e.addEventListener("submit",async e=>{e.preventDefault(),t.textContent="",a.textContent="";const r=n.querySelector("#email").value.trim(),o=n.querySelector("#password").value;try{const n=await k({email:r,password:o});if(n.error)return void(t.textContent=n.message||"Login gagal. Periksa kembali email dan kata sandi.");localStorage.setItem("token",n.loginResult.token),localStorage.setItem("name",n.loginResult.name),a.textContent=`Login berhasil! Selamat datang, ${n.loginResult.name}! ðŸŽ‰`,window.updateAuthUI&&window.updateAuthUI(),setTimeout(()=>{"#/home"!==location.hash?location.hash="#/home":window.dispatchEvent(new HashChangeEvent("hashchange"))},1200)}catch(n){t.textContent="Terjadi kesalahan jaringan. Coba lagi nanti.",console.error(n)}}),n}function j(){const n=document.createElement("section");return n.innerHTML='\n<h1>Daftar</h1>\n<form class="form" id="reg" novalidate>\n  <label for="name">Nama</label>\n  <input id="name" required />\n\n  <label for="email">Email</label>\n  <input id="email" type="email" required />\n\n  <label for="password">Kata sandi (â‰¥8)</label>\n  <input id="password" type="password" minlength="8" required />\n\n  <button type="submit">Buat Akun</button>\n  <p class="success" id="ok" aria-live="polite"></p>\n  <p class="error" id="err" aria-live="polite"></p>\n</form>\n',n.querySelector("#reg").addEventListener("submit",async e=>{e.preventDefault();const t=n.querySelector("#name").value.trim(),a=n.querySelector("#email").value.trim(),r=n.querySelector("#password").value,o=n.querySelector("#ok"),i=n.querySelector("#err");o.textContent="",i.textContent="";const s=await w({name:t,email:a,password:r});s.error?i.textContent=s.message||"Gagal daftar":o.textContent="Akun dibuat. Silakan login."}),n}async function z(n=!0){const e=await C();if(e.length){for(const n of e)try{if(!(await S.create({description:n.description,photoFile:n.photoFile,lat:n.lat,lon:n.lon,guest:n.guest})).error&&(await T(n.id),navigator.serviceWorker)){const e=await navigator.serviceWorker.getRegistration();await(e?.showNotification("Story terkirim",{body:n.description?.slice(0,90)||"Berhasil mengirim story dari mode offline.",icon:"/icons/icon-192.png",badge:"/icons/badge.png",data:{go:"#/home"},actions:[{action:"open",title:"Lihat di Home"}]}))}}catch{}if(n){const n=document.createElement("p");n.className="success",n.textContent="Sinkronisasi offline selesai (jika ada story yang tertunda).",document.getElementById("main-content")?.prepend(n),setTimeout(()=>n.remove(),2500)}}}function P(){const n=document.createElement("section");n.innerHTML='\n    <h1>Tambah Story</h1>\n    <p class="hint">\n      Klik peta untuk memilih lokasi. Kamu bisa mengunggah foto atau ambil langsung dari kamera.\n    </p>\n\n    <div id="map" class="map map-add" aria-label="Pilih lokasi di peta"></div>\n\n    <form class="form" id="form" novalidate>\n      <label for="desc">Deskripsi</label>\n      <textarea id="desc" required rows="3" placeholder="Tulis deskripsi..."></textarea>\n\n      <label for="photo">Foto (â‰¤ 1MB)</label>\n      <input id="photo" type="file" accept="image/*" required />\n\n      <div class="row-2">\n        <div>\n          <label for="lat">Latitude</label>\n          <input id="lat" type="number" step="any" readonly />\n        </div>\n        <div>\n          <label for="lon">Longitude</label>\n          <input id="lon" type="number" step="any" readonly />\n        </div>\n      </div>\n\n      <details>\n        <summary>Ambil foto dari kamera</summary>\n        <video id="cam" autoplay playsinline\n          style="width:100%;max-height:240px;border-radius:8px"></video>\n        <div style="display:flex;gap:8px;margin:8px 0;">\n          <button id="startCam" type="button">Mulai Kamera</button>\n          <button id="capture" type="button">Ambil Gambar</button>\n          <button id="stopCam" type="button">Matikan Kamera</button>\n        </div>\n        <canvas id="canvas" width="640" height="480" hidden></canvas>\n      </details>\n\n      <label for="guest" style="display:inline-flex;align-items:center;gap:8px;">\n        <input type="checkbox" id="guest" />\n        Kirim sebagai tamu (tanpa login)\n      </label>\n\n      <button type="submit" id="submitBtn">Kirim</button>\n      <p class="success" id="ok" aria-live="polite"></p>\n      <p class="error" id="err" aria-live="polite"></p>\n    </form>\n  ';const e=L.map(n.querySelector("#map"),{center:[-2.5,118],zoom:4});let t,a;L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap"}).addTo(e),function(n){return new Promise(e=>{if(document.body.contains(n))return e();const t=new MutationObserver(()=>{document.body.contains(n)&&(t.disconnect(),e())});t.observe(document.body,{childList:!0,subtree:!0})})}(n).then(()=>setTimeout(()=>e.invalidateSize(),0)),window.addEventListener("resize",()=>e.invalidateSize(),{passive:!0}),e.on("click",({latlng:{lat:a,lng:r}})=>{n.querySelector("#lat").value=Number(a).toFixed(6),n.querySelector("#lon").value=Number(r).toFixed(6),t?t.setLatLng([a,r]):t=L.marker([a,r]).addTo(e)});const r=n.querySelector("#cam"),o=n.querySelector("#canvas");n.querySelector("#startCam").addEventListener("click",async()=>{try{a=await navigator.mediaDevices.getUserMedia({video:!0}),r.srcObject=a}catch{alert("Tidak bisa mengakses kamera.")}});const i=()=>{a&&(a.getTracks().forEach(n=>n.stop()),a=null,r.srcObject=null)};return n.querySelector("#stopCam").addEventListener("click",i),window.addEventListener("hashchange",i,{once:!0}),n.querySelector("#capture").addEventListener("click",()=>{r.srcObject&&(o.hidden=!1,o.getContext("2d").drawImage(r,0,0,o.width,o.height),o.toBlob(e=>{const t=new File([e],"camera.jpg",{type:e.type||"image/jpeg"}),a=new DataTransfer;a.items.add(t),n.querySelector("#photo").files=a.files},"image/jpeg",.9))}),n.querySelector("#form").addEventListener("submit",async e=>{e.preventDefault();const t=n.querySelector("#desc").value.trim(),a=n.querySelector("#photo").files[0],r=n.querySelector("#lat").value,o=n.querySelector("#lon").value,i=r?parseFloat(r):void 0,s=o?parseFloat(o):void 0,l=n.querySelector("#guest").checked,c=n.querySelector("#err"),d=n.querySelector("#ok"),p=n.querySelector("#submitBtn");if(c.textContent="",d.textContent="",!t)return c.textContent="Deskripsi wajib.";if(!a)return c.textContent="Foto wajib.";if(a.size>1048576)return c.textContent="Ukuran foto > 1MB.";p.disabled=!0;try{const n=await S.create({description:t,photoFile:a,lat:i,lon:s,guest:l});if(n.error)throw new Error(n.message||"Gagal membuat story");if(d.textContent="Story berhasil dibuat!",navigator.serviceWorker){const n=await navigator.serviceWorker.getRegistration();await(n?.showNotification("Story berhasil",{body:t.slice(0,90),icon:"/icons/icon-192.png",badge:"/icons/badge.png",data:{go:"#/home"},actions:[{action:"open",title:"Lihat di Home"}]}))}location.hash="#/home"}catch{try{await async function(n){const e=(await E()).transaction("outbox","readwrite");await e.objectStore("outbox").add(n),await(e.done?.catch?.(()=>{}))}({description:t,photoFile:a,lat:i,lon:s,guest:l,createdAt:Date.now()}),d.textContent="Tidak ada koneksi. Story disimpan offline dan akan dikirim otomatis saat online.";try{const n=await(navigator.serviceWorker?.getRegistration());await(n?.sync?.register("sync-outbox"))}catch{}}catch{c.textContent="Gagal menyimpan ke penyimpanan offline."}}finally{p.disabled=!1}}),navigator.onLine&&z(!1),window.addEventListener("online",()=>z()),n}function B(){const n={"/home":A,"/about":M,"/login":I,"/register":j,"/add-story":P},e=location.hash.replace(/^#/,"")||"/home",t=document.getElementById("main-content");t.innerHTML="";const a=n[e]||A;a().then?.(n=>t.appendChild(n))||t.appendChild(a()),document.startViewTransition&&document.startViewTransition(()=>{})}async function O(){return"serviceWorker"in navigator?await navigator.serviceWorker.register("./sw.js"):null}function F(n){const e=(n+"=".repeat((4-n.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),a=new Uint8Array(t.length);for(let n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return a}async function $(){const n=await O();return n?.pushManager.getSubscription()}let N=null;async function D(){const n=!!localStorage.getItem("token");document.body.classList.toggle("auth",n),document.body.classList.toggle("guest",!n);const e=document.querySelector("[data-nav-guest]"),t=document.querySelector("[data-nav-auth]");e&&(e.hidden=n),t&&(t.hidden=!n);const a=document.getElementById("btn-push");if(a){const e=await $();a.textContent=e?"Disable Push":"Enable Push",a.disabled=!n}window.updateAuthUI=D}async function H(){try{const n=await C();if(!n?.length)return;for(const e of n)try{await S.create({description:e.description,photoFile:e.photoFile,lat:e.lat,lon:e.lon,guest:e.guest}),await T(e.id)}catch{}}catch{}}document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("year");n&&(n.textContent=(new Date).getFullYear()),D(),function(){const n=document.getElementById("btn-push");n&&n.addEventListener("click",async()=>{try{await $()?await async function(){const n=await O(),e=await(n?.pushManager.getSubscription());if(e){try{await fetch(`${y}/push/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify(await e.toJSON())})}catch{}await e.unsubscribe()}}():await async function(){if(!("Notification"in window))throw new Error("Browser tidak mendukung notifikasi.");if("granted"!==await Notification.requestPermission())throw new Error("Izin notifikasi ditolak.");const n=await O(),e=await n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:F(b)});try{await fetch(`${y}/push/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")||""}`},body:JSON.stringify(await e.toJSON())})}catch{}return e}(),D(),alert("Pengaturan push diperbarui.")}catch(n){alert(n?.message||"Gagal mengatur push notification.")}})}(),function(){const n=document.getElementById("btn-install");window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),N=e,n&&(n.hidden=!1)}),n&&n.addEventListener("click",async()=>{N&&(N.prompt(),await N.userChoice,N=null,n.hidden=!0)})}(),window.addEventListener("hashchange",()=>{B(),D()}),B();const e=document.querySelector(".skip-link");e&&e.addEventListener("click",n=>{n.preventDefault();const e=document.getElementById("main-content");e&&(e.setAttribute("tabindex","-1"),e.focus({preventScroll:!1}))}),document.querySelector("[data-logout]")?.addEventListener("click",n=>{n.preventDefault(),localStorage.removeItem("token"),localStorage.removeItem("name"),D(),location.hash="#/home"}),O().catch(()=>{}),navigator.serviceWorker?.addEventListener?.("message",n=>{"NAVIGATE"===n.data?.type&&"string"==typeof n.data.hash&&(location.hash=n.data.url.replace(location.origin,"")),"FLUSH_OUTBOX"===n.data?.type&&H()}),window.addEventListener("online",H),H()})})();