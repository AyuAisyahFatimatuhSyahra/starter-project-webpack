const VERSION="v2",APP_SHELL=["/","/index.html","/main.js"],SHELL_CACHE="shell-v2",DATA_CACHE="data-v2";self.addEventListener("install",t=>{t.waitUntil(caches.open(SHELL_CACHE).then(t=>t.addAll(APP_SHELL)).catch(()=>{})),self.skipWaiting()}),self.addEventListener("activate",t=>{t.waitUntil(caches.keys().then(t=>Promise.all(t.map(t=>{if(![SHELL_CACHE,DATA_CACHE].includes(t))return caches.delete(t)})))),self.clients.claim()}),self.addEventListener("fetch",t=>{const e=t.request,n=new URL(e.url);"GET"===e.method&&("navigate"!==e.mode?n.origin!==location.origin?"story-api.dicoding.dev"!==n.hostname?t.respondWith(caches.match(e).then(t=>{const n=fetch(e).then(t=>{const n=t.clone();return caches.open(SHELL_CACHE).then(t=>t.put(e,n)),t}).catch(()=>t);return t||n})):t.respondWith(fetch(e).then(t=>{const n=t.clone();return caches.open(DATA_CACHE).then(t=>t.put(e,n)),t}).catch(()=>caches.match(e))):t.respondWith(caches.match(e).then(t=>t||fetch(e).then(t=>{const n=t.clone();return caches.open(SHELL_CACHE).then(t=>t.put(e,n)),t}))):t.respondWith(fetch(e).catch(()=>caches.match("/index.html"))))}),self.addEventListener("push",t=>{let e="Story",n={body:"Notifikasi baru",icon:"/icons/icon-192.png",badge:"/icons/badge.png",data:{go:"#/home"}};try{const a=t.data.json();e=a.title||e,n={...n,...a.options||{}},n.data=n.data||{},n.data.go=n.data.go||"#/home"}catch{}t.waitUntil(self.registration.showNotification(e,n))}),self.addEventListener("notificationclick",t=>{t.notification.close();const e=t.notification.data?.go||"#/home";t.waitUntil((async()=>{const t=await clients.matchAll({type:"window",includeUncontrolled:!0});t.length?(t[0].focus(),t[0].postMessage({type:"navigate",url:e})):clients.openWindow(e)})())}),self.addEventListener("sync",t=>{"sync-outbox"===t.tag&&t.waitUntil((async()=>{(await clients.matchAll({type:"window",includeUncontrolled:!0})).forEach(t=>t.postMessage({type:"FLUSH_OUTBOX"}))})())}),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil((async()=>{(await clients.matchAll({type:"window",includeUncontrolled:!0})).forEach(t=>t.postMessage({type:"PUSH_SUBSCRIPTION_CHANGED"}))})())});